{
  "variables": {
    "registry_url": null,
    "registry_username": null,
    "registry_password": null,
    "docker_image": null,
    "s3_bucket": null,
    "ami_name": null,
    "aws_access_key": "",
    "aws_secret_key": "",
    "aws_region": "eu-central-1",
    "instance_type": "t2.micro",
    "source_ami": "ami-0ac05733838eabc06",
    "ssh_username": "ubuntu",
    "container_format": "ova",
    "disk_image_format": "VMDK",
    "target_environment": "vmware"
  },
  "sensitive-variables": [
    "registry_username", 
    "registry_password",
    "aws_access_key",
    "aws_secret_key"
  ],
  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [
        "REGISTRY_URL={{user `registry_url`}}",
        "REGISTRY_USERNAME={{user `registry_username`}}",
        "REGISTRY_PASSWORD={{user `registry_password`}}",
        "DOCKER_IMAGE={{user `docker_image`}}"
      ],
      "script": "scripts/docker.sh"
    }
  ],
  "builders": [
    {
      "type": "amazon-ebs",
      "communicator": "ssh",
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "region": "{{user `aws_region`}}",
      "source_ami": "{{user `source_ami`}}",
      "instance_type": "{{user `instance_type`}}",
      "ssh_username": "{{user `ssh_username`}}",
      "ami_name": "{{user `ami_name`}}"
    }
  ],
  "post-processors": [
    [
      {
        "type": "shell-local",
        "execute_command": "{{.Vars}} bash '{{.Script}}'",
        "script": "scripts/convert-to-ova.sh",
        "environment_vars": [
          "AMI_NAME={{user `ami_name`}}",
          "CONTAINER_FORMAT={{user `container_format`}}",
          "DISK_IMAGE_FORMAT={{user `disk_image_format`}}",
          "INSTANCE_TYPE={{user `instance_type`}}",
          "S3_BUCKET={{user `s3_bucket`}}",
          "TARGET_ENVIRONMENT={{user `target_environment`}}"
        ]
      }
    ]
  ]
}
